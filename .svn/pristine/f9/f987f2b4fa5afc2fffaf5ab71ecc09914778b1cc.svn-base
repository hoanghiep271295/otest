"use strict";var SysmenuList=React.createClass({displayName:"SysmenuList",getInitialState:function(){return{agGrid:{setRowData:null,getDataChange:null,setNextRow:null,setPrevRow:null},rowSelect:null,columnDefs:[{headerName:"Tên",field:"NAME",width:450,editable:!1},{headerName:"Không hiển thị",field:"LOCK",width:150,editable:!1,type:"checkbox"},{headerName:"Thứ tự",field:"THEORDER",width:100,align:"center",editable:!1},{headerName:"Biểu tượng",field:"ICON",width:150,align:"center",editable:!1},{headerName:"Liên kết",field:"LINK",width:200,align:"center",editable:!1},{headerName:"Phân quyền",field:"PRIORITYCODE",width:200,align:"center",editable:!1}],lst:[],currentcode:"",buts:[{title:"Thêm mới",callback:this.onNewClick,icon:" fa fa-files-o",ref:"cmdAdd"},{title:"Sửa",callback:this.onEidtClick,icon:"fa fa-edit",ref:"cmdEdit"},{title:"Xóa",callback:this.onDeleteClick,icon:"fa fa-trash-o fa-fw",ref:"cmdDel"},{title:"In",callback:this.docallback,icon:"fa fa-line-chart",ref:"cmdPri"},{title:"Lọc",callback:this.searchCall,icon:"fa fa-filter",ref:"cmdFil"}],parentcode:"",parentextcode:""}},componentWillMount:function(){var n=getDefaultFromServer();this.setState({currentcode:n.code})},componentDidMount:function(){this.loadTree();setTitle("sys_title","Quản lý menu hệ thống");setTree("sys_path",[{title:"Menus",status:"active",link:""}]);this.state.currentcode!==""&&$("#sysmenu_list_tree").jstree("select_node",this.state.currentcode);this.loadData()},loadTree:function(){var n=this.refs.hidTheType.value,t={thetype:n};$.ajax({url:"/sysmenu/getBackend",dataType:"json",data:t,success:function(n){this.setState({lst:n.lst})}.bind(this),error:function(n,t,i){console.error(this.props.url,t,i.toString())}.bind(this)})},TreeSelect:function(n){var r=this.state.currentcode,t="",u="Hệ thống menu",i;n!=null&&n.length>0&&(t=n[0].id,u=n[0].text,this.setState({parentcode:n[0].id,parentextcode:n[0].idext}));r!==t&&(this.setState({currentcode:t}),i={Page:"currentpage",Url:"/sysmenu/index/"+t},history.pushState(i,i.Page,i.Url),this.loadData())},initAgGrid:function(n,t,i,r){var u={setRowData:n,getDataChange:t,setNextRow:i,setPrevRow:r};this.setState({agGrid:u})},loadData:function(){return this.loadDataSearch("","","","")},loadDataSearch:function(n,t,i,r){var f=this.state.currentcode,e=this.refs.hidTheType.value,o={code:f,thetype:e,name:n,nametype:t,note:i,notetype:r},u=0;return $.ajax({url:"/sysmenu/getBackendList",dataType:"json",data:o,success:function(n){u=n.lst;this.setState({rowSelect:null});n.ret>=0&&this.state.agGrid.setRowData(n.lst)}.bind(this),error:function(n,t,i){console.log(i.toString())}}),u},ReloadList:function(){this.loadTree();this.loadData()},ReloadListDelete:function(){this.loadTree();this.loadData()},onRowSelect:function(n){this.setState({rowSelect:n})},onNewClick:function(){var n={PARENTEXT:this.state.parentextcode,PARENTCODE:this.state.parentcode,THETYPE:this.refs.hidTheType.value};this.refs.sysmenuPopup.ClearInput(n);this.refs.sysmenuPopup.Show()},onEidtClick:function(){if(this.state.rowSelect.length!=1)bootbox.alert("Chưa chọn bản ghi hoặc nhiều hơn một bản ghi");else{var n=this.state.rowSelect[0],t={NAME:n.NAME,PARENTEXT:this.state.parentextcode,PARENTCODE:this.state.parentcode,CODE:n.CODE,THEORDER:n.THEORDER,NOTE:n.NOTE,ICON:n.ICON,PRIORITY:n.PRIORITYCODE,THETYPE:this.refs.hidTheType.value,LINK:n.LINK,LOCK:n.LOCK};this.refs.sysmenuPopup.SetInput(t);this.refs.sysmenuPopup.Show()}},handDelete:function(){var n,t;this.state.rowSelect?(n=[],this.state.rowSelect.forEach(function(t){n.push(t.CODE)}),t={code:n},$.ajax({url:"/sysmenu/delete",type:"POST",dataType:"json",traditional:!0,data:t,success:function(n){n.ret>=0?this.ReloadListDelete():n.ret==-2?bootbox.alert("Bản ghi có tham chiếu, cần xóa các menu con trước!",!1):bootbox.alert("Lỗi khi xóa dữ liệu!",!1)}.bind(this),error:function(n,t,i){console.log(i.toString())}})):bootbox.alert("Không có bản ghi nào!",!1)},onDeleteClick:function(){var n=this;if(!this.state.rowSelect||this.state.rowSelect.length==0)return bootbox.alert("Chưa chọn bản ghi"),!1;bootbox.confirm({message:"Xóa các bản ghi được lựa chọn ?",buttons:{confirm:{label:"Yes",className:"btn btn-danger"},cancel:{label:"No",className:"btn btn-default"}},callback:function(t){t?n.handDelete():console.log("No items have been deleted",!0)}})},searchCall:function(){this.refs.sysmenuSearch.Show()},searchCallback:function(n){var t=n.searchMenu_name.value,i=n.searchMenu_name.type,r=n.searchMenu_note.value,u=n.searchMenu_note.type;return this.loadDataSearch(t,i,r,u)},render:function(){var n=this,t=this;return React.createElement("div",{className:"box"},React.createElement("div",{className:"row"},React.createElement("input",{type:"hidden",value:"BACKEND",ref:"hidTheType",id:"hidTheType"}),React.createElement("div",{className:"col-xs-3",style:{borderRight:"1px solid gray",minHeight:550}},React.createElement("a",{href:"#",onClick:function(){return n.TreeSelect(null)}},"Hệ thống menu"),React.createElement(Tree,{id:"sysmenu_list_tree",data:this.state.lst,mapper:{id:"CODE",text:"NAME",parent:"PARENTCODE",idext:"EXTENSIONCODE"},callback:this.TreeSelect,height:"450px"})),React.createElement("div",{className:"col-xs-9"},React.createElement(ButtonList,{list:this.state.buts}),React.createElement("div",{id:"listSubCon",className:"tab-pane fade  in active"},React.createElement(SysmenuPopup,{setData:this.setData,onPre:this.onPrevClick,onNext:this.onNextClick,ReloadData:this.ReloadList,ref:"sysmenuPopup"}),React.createElement(SearchDialog,{title:"Tìm kiếm menu",lst:[{title:"Tên menu",id:"searchMenu_name",type:"text",combo:"block"},{title:"Ghi chú",id:"searchMenu_note",type:"text",combo:"block"}],callback:this.searchCallback,ref:"sysmenuSearch"}),React.createElement("div",{id:"myGridSQ",className:"ag-fresh",style:{width:"100%",height:"400px"}}),React.createElement(AgGrid,{container:"myGridSQ",initAgGrid:this.initAgGrid,loadData:this.loadData,onRowSelect:this.onRowSelect,columnDefs:this.state.columnDefs,headerCheckBox:!0})))))}});ReactDOM.render(React.createElement(SysmenuList,null),document.getElementById("container"));